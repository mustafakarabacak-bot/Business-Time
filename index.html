<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Business Time</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon.png">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    :root {
      --bg: #f4f6fc;
      --text: #1a1a1a;
      --box: #ffffff;
      --accent: #1a73e8;
      --gold: #d4af37;
    }
    body.dark {
      --bg: #121212;
      --text: #f4f4f4;
      --box: #1e1e1e;
      --accent: #8ab4f8;
    }
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', sans-serif;
      transition: background 0.3s, color 0.3s;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 5vw;
      background: var(--box);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .logo {
      height: 40px;
    }
    .profile-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .profile-photo {
      height: 40px;
      width: 40px;
      border-radius: 50%;
      object-fit: cover;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .username {
      font-size: 1rem;
      opacity: 0.7;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .container {
      flex: 1;
      padding: 1rem 5vw;
      overflow-y: auto;
    }
    .input-group {
      max-width: 500px;
      margin: 1rem auto;
    }
    .input-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      font-size: 1rem;
    }
    .input-group input, 
    .input-group select {
      width: 100%;
      padding: 0.75rem;
      border-radius: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      background: var(--box);
      color: var(--text);
    }
    .time-group {
      display: flex;
      gap: 1rem;
    }
    .buttons {
      max-width: 500px;
      margin: 1rem auto;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
    }
    .buttons button {
      flex: 1 1 100%;
      padding: 1rem;
      font-size: 1rem;
      font-weight: bold;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      min-width: 120px;
    }
    @media (min-width: 480px) {
      .buttons button {
        flex: 1 1 45%;
      }
    }
    .start-btn { background: #34a853; color: white; }
    .stop-btn  { background: #ea4335; color: white; }
    .reset-btn { background: #fbbc04; color: white; }
    .dark-toggle { background: var(--accent); color: white; }
    .earnings-box {
      max-width: 500px;
      margin: 1.5rem auto;
      background: var(--box);
      font-size: 2rem;
      font-weight: bold;
      padding: 1rem;
      text-align: center;
      border-radius: 1rem;
      color: var(--gold);
    }
    .summary {
      max-width: 500px;
      margin: 1rem auto 3rem;
      font-size: 1rem;
      text-align: center;
      color: var(--text);
    }
    .chart-container {
      max-width: 500px;
      margin: 1rem auto;
    }
    #earningsChart {
      width: 100% !important;
      height: auto !important;
    }
    .nav {
      display: flex;
      justify-content: space-around;
      background: var(--box);
      padding: 0.5rem 0;
      border-top: 1px solid #ccc;
    }
    .nav button {
      background: none;
      border: none;
      font-size: 1rem;
      font-weight: bold;
      color: var(--accent);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.5rem;
    }
    .nav-icon {
      font-size: 1.5rem;
    }
    .hidden { 
      display: none; 
    }
    #profileView input,
    #profileView textarea {
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      margin-bottom: 1rem;
      border-radius: 0.5rem;
      border: 1px solid #ccc;
      background: var(--box);
      color: var(--text);
    }
    #profileView h2 {
      text-align: center;
      margin-bottom: 1rem;
      font-size: 1.5rem;
      color: var(--accent);
    }
    #careerSuggestion {
      margin-top: 1rem;
      font-size: 1rem;
      color: var(--accent);
      text-align: center;
    }
    #jobLinks a {
      display: block;
      margin: 0.5rem 0;
      font-size: 0.9rem;
      color: var(--accent);
      text-decoration: none;
    }
    #jobLinks a:hover {
      text-decoration: underline;
    }
    #settingsView label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      font-size: 1rem;
    }
    #settingsView input,
    #settingsView select {
      width: 100%;
      padding: 0.75rem;
      border-radius: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      background: var(--box);
      color: var(--text);
      margin-bottom: 1rem;
    }
    #settingsView button {
      width: 100%;
      padding: 1rem;
      font-size: 1rem;
      font-weight: bold;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      background: #ea4335;
      color: white;
      margin-top: 1rem;
    }
    #settingsView h2 {
      text-align: center;
      margin-bottom: 1rem;
      font-size: 1.5rem;
      color: var(--accent);
    }
  </style>
</head>
<body>
  <header>
    <img src="icon.png" class="logo" alt="logo" />
    <div class="profile-info">
      <img id="profilePhoto" class="profile-photo" src="" alt="Profil Fotoƒürafƒ±" />
      <div class="username" id="displayName"></div>
    </div>
  </header>

  <div class="container">
    <main id="mainView">
      <div class="input-group">
        <label for="salary">Maa≈ü Bilgisi (TL)</label>
        <input type="number" id="salary" placeholder="Aylƒ±k maa≈üƒ±nƒ±zƒ± girin">
      </div>
      <div class="input-group">
        <label for="monthlyHours">Aylƒ±k √áalƒ±≈üma S√ºresi (saat)</label>
        <input type="number" id="monthlyHours" placeholder="√ñrn: 173.33">
      </div>
      <div class="input-group">
        <label>Ek S√ºre</label>
        <div class="time-group">
          <input type="number" id="extraHours" placeholder="Saat">
          <input type="number" id="extraMinutes" placeholder="Dakika">
        </div>
      </div>
      <div class="input-group">
        <label>G√ºnl√ºk Hedef (saat)</label>
        <input type="number" id="dailyGoal" placeholder="√ñrn: 8">
      </div>
      <div class="buttons">
        <button class="start-btn" onclick="startTracking()">BA≈ûLAT</button>
        <button class="stop-btn" onclick="stopTracking()">DURDUR</button>
        <button class="reset-btn" onclick="confirmDailyReset()">SIFIRLA (G√ºnl√ºk)</button>
        <button class="dark-toggle" onclick="toggleDarkMode()">GECE MODU</button>
      </div>
      <div class="earnings-box" id="earnings">0,00 TL</div>
      <div class="summary">
        <div id="timeDisplay">Toplam S√ºre: 0 saat 0 dakika 0 saniye</div>
        <div id="overtimeDisplay">Fazla Mesai: 0 saat 0 dakika 0 saniye</div>
      </div>
      <div class="chart-container">
        <select id="chartRange" onchange="drawChart()">
          <option value="daily">G√ºnl√ºk</option>
          <option value="weekly">Haftalƒ±k</option>
          <option value="monthly">Aylƒ±k</option>
        </select>
        <canvas id="earningsChart"></canvas>
      </div>
    </main>

    <main id="profileView" class="hidden">
      <h2>Profil</h2>
      <input type="file" id="photoUpload" accept="image/*" style="margin-bottom:1rem;">
      <input id="careerTitle" placeholder="Meslek / Alan">
      <textarea id="careerSkills" placeholder="Beceriler, ilgi alanlarƒ±" style="height:150px;"></textarea>
      <div id="careerSuggestion"></div>
      <div id="jobLinks"></div>
    </main>

    <main id="settingsView" class="hidden">
      <h2>Ayarlar</h2>
      <label for="currency">D√∂viz Cinsi</label>
      <select id="currency">
        <option value="TL">TL</option>
        <option value="USD">USD</option>
        <option value="EUR">EUR</option>
      </select>
      <label for="exchangeRate">D√∂viz Kuru (1 birim USD/EUR = ? TL)</label>
      <input type="number" step="0.01" id="exchangeRate" placeholder="√ñrn: 32.50">
      <label for="overtimeMultiplier">Fazla Mesai √áarpanƒ±</label>
      <input type="number" step="0.1" id="overtimeMultiplier" placeholder="√ñrn: 1.5 (default)">
      <label for="themeSelect">Tema</label>
      <select id="themeSelect">
        <option value="auto">Otomatik</option>
        <option value="light">Aydƒ±nlƒ±k</option>
        <option value="dark">Koyu</option>
      </select>
      <button onclick="confirmAllReset()">T√ºm Verileri Sƒ±fƒ±rla</button>
    </main>
  </div>

  <nav class="nav">
    <button onclick="showView('main')">
      <span class="nav-icon">üè†</span>
      Ana Sayfa
    </button>
    <button onclick="showView('profile')">
      <span class="nav-icon">üë§</span>
      Profil
    </button>
    <button onclick="showView('settings')">
      <span class="nav-icon">‚öôÔ∏è</span>
      Ayarlar
    </button>
  </nav>

  <audio id="startSound" src="start.mp3" style="display:none"></audio>
  <audio id="stopSound" src="stop.mp3" style="display:none"></audio>

  <script>
    // Service Worker Kayƒ±t
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(err => {
          console.log('ServiceWorker kaydƒ± ba≈üarƒ±sƒ±z:', err);
        });
      });
    }

    // Deƒüi≈ükenler
    let timer;
    let startTimestamp = parseInt(localStorage.getItem('startTimestamp')) || null;
    let baseSeconds = parseInt(localStorage.getItem('baseSeconds')) || 0;
    let isRunning = localStorage.getItem('isRunning') === 'true';
    let goal = parseFloat(localStorage.getItem('dailyGoal')) || 8;
    let currency = localStorage.getItem('currency') || 'TL';
    let exchangeRate = parseFloat(localStorage.getItem('exchangeRate')) || 1;
    let overtimeMultiplier = parseFloat(localStorage.getItem('overtimeMultiplier')) || 1.5;
    let earnings = parseFloat(localStorage.getItem('earnings')) || 0;
    let name = localStorage.getItem('username');
    let chartInstance = null;

    // DOM Elemanlarƒ±
    const photoUpload = document.getElementById('photoUpload');
    const profilePhoto = document.getElementById('profilePhoto');
    const displayName = document.getElementById('displayName');
    const salaryInput = document.getElementById('salary');
    const monthlyHoursInput = document.getElementById('monthlyHours');
    const extraHoursInput = document.getElementById('extraHours');
    const extraMinutesInput = document.getElementById('extraMinutes');
    const dailyGoalInput = document.getElementById('dailyGoal');
    const titleInput = document.getElementById('careerTitle');
    const skillsInput = document.getElementById('careerSkills');
    const currencySelect = document.getElementById('currency');
    const exchangeRateInput = document.getElementById('exchangeRate');
    const overtimeInput = document.getElementById('overtimeMultiplier');
    const themeSelect = document.getElementById('themeSelect');
    const chartRangeSelect = document.getElementById('chartRange');
    const startSound = document.getElementById('startSound');
    const stopSound = document.getElementById('stopSound');

    // Profil Fotoƒürafƒ± Y√ºkleme
    if (localStorage.getItem('profilePhoto')) {
      profilePhoto.src = localStorage.getItem('profilePhoto');
      profilePhoto.style.visibility = 'visible';
      profilePhoto.style.opacity = '1';
    }
    photoUpload.onchange = e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(evt) {
        localStorage.setItem('profilePhoto', evt.target.result);
        profilePhoto.src = evt.target.result;
        profilePhoto.style.visibility = 'visible';
        profilePhoto.style.opacity = '1';
      };
      reader.readAsDataURL(file);
    };

    // Kullanƒ±cƒ± Adƒ± Ayarla
    if (!name) {
      name = prompt("Ho≈ü geldiniz! L√ºtfen adƒ±nƒ±zƒ± ve soyadƒ±nƒ±zƒ± girin:");
      if (name) {
        localStorage.setItem('username', name);
        displayName.innerText = name;
        displayName.style.visibility = 'visible';
        displayName.style.opacity = '1';
      }
    } else {
      displayName.innerText = name;
      displayName.style.visibility = 'visible';
      displayName.style.opacity = '1';
    }

    // Kayƒ±tlƒ± Deƒüerleri Y√ºkle
    salaryInput.value = localStorage.getItem('salary') || '';
    monthlyHoursInput.value = localStorage.getItem('monthlyHours') || '173.33';
    extraHoursInput.value = localStorage.getItem('extraHours') || 0;
    extraMinutesInput.value = localStorage.getItem('extraMinutes') || 0;
    dailyGoalInput.value = goal;
    titleInput.value = localStorage.getItem('careerTitle') || '';
    skillsInput.value = localStorage.getItem('careerSkills') || '';
    currencySelect.value = currency;
    exchangeRateInput.value = exchangeRate;
    overtimeInput.value = overtimeMultiplier;
    themeSelect.value = localStorage.getItem('theme') || 'auto';

    // Tema Uygula
    function applyTheme() {
      const saved = localStorage.getItem('theme');
      if (saved === 'light') document.body.classList.remove('dark');
      else if (saved === 'dark') document.body.classList.add('dark');
      else {
        const hour = new Date().getHours();
        document.body.classList.toggle('dark', hour >= 19 || hour < 6);
      }
    }
    themeSelect.onchange = () => {
      localStorage.setItem('theme', themeSelect.value);
      applyTheme();
    };
    applyTheme();

    // Input Deƒüi≈üikliklerini Kaydet
    salaryInput.onchange = () => localStorage.setItem('salary', salaryInput.value);
    monthlyHoursInput.onchange = () => localStorage.setItem('monthlyHours', monthlyHoursInput.value);
    extraHoursInput.onchange = () => localStorage.setItem('extraHours', extraHoursInput.value);
    extraMinutesInput.onchange = () => localStorage.setItem('extraMinutes', extraMinutesInput.value);
    dailyGoalInput.onchange = () => {
      goal = parseFloat(dailyGoalInput.value) || 8;
      localStorage.setItem('dailyGoal', goal);
    };
    titleInput.oninput = e => localStorage.setItem('careerTitle', e.target.value);
    skillsInput.oninput = e => {
      localStorage.setItem('careerSkills', e.target.value);
      showSuggestions(e.target.value);
      showJobLinks(e.target.value);
    };
    currencySelect.onchange = () => {
      currency = currencySelect.value;
      localStorage.setItem('currency', currency);
      drawChart();
      updateDisplay();
    };
    exchangeRateInput.onchange = () => {
      exchangeRate = parseFloat(exchangeRateInput.value) || 1;
      localStorage.setItem('exchangeRate', exchangeRate);
      drawChart();
      updateDisplay();
    };
    overtimeInput.onchange = () => {
      overtimeMultiplier = parseFloat(overtimeInput.value) || 1.5;
      localStorage.setItem('overtimeMultiplier', overtimeMultiplier);
    };

    // Toplam S√ºre Hesapla
    function getCurrentSeconds() {
      return isRunning && startTimestamp !== null 
        ? baseSeconds + Math.floor(Date.now() / 1000) - startTimestamp 
        : baseSeconds;
    }

    // Kazan√ß Hesapla
    function calculateEarnings(totalSec) {
      const salary = parseFloat(salaryInput.value);
      const monthlyHours = parseFloat(monthlyHoursInput.value) || 173.33;
      if (isNaN(salary) || isNaN(monthlyHours) || monthlyHours === 0) return 0;
      
      const hourlyRate = salary / monthlyHours;
      const limitSec = 180 * 3600;
      const regularSeconds = Math.min(totalSec, limitSec);
      const overtimeSeconds = Math.max(totalSec - limitSec, 0);
      
      const regularEarnings = regularSeconds * (hourlyRate / 3600);
      const overtimeEarnings = overtimeSeconds * (hourlyRate / 3600) * overtimeMultiplier;
      
      return +(regularEarnings + overtimeEarnings).toFixed(2);
    }

    // G√ºnl√ºk Hedef Kontrol√º
    function checkDailyGoal(totalSec) {
      const todayKey = new Date().toISOString().split('T')[0];
      const alreadyNotified = localStorage.getItem('goalCongrats_' + todayKey);
      const hoursWorked = totalSec / 3600;
      
      if (hoursWorked >= goal && !alreadyNotified) {
        alert('üéâ Tebrikler! G√ºnl√ºk hedefi a≈ütƒ±nƒ±z.');
        localStorage.setItem('goalCongrats_' + todayKey, 'true');
      }
    }

    // Ekranƒ± G√ºncelle
    function updateDisplay() {
      const totalSec = getCurrentSeconds();
      const earned = calculateEarnings(totalSec);
      
      document.getElementById('earnings').innerText = 
        earned.toFixed(2).replace('.', ',') + ' ' + currency;

      const hours = Math.floor(totalSec / 3600);
      const remAfterHours = totalSec % 3600;
      const minutes = Math.floor(remAfterHours / 60);
      const seconds = remAfterHours % 60;
      
      document.getElementById('timeDisplay').innerText =
        `Toplam S√ºre: ${hours} saat ${minutes} dakika ${seconds} saniye`;

      const limitSec = 180 * 3600;
      const extraTime = Math.max(totalSec - limitSec, 0);
      const ehours = Math.floor(extraTime / 3600);
      const eminutes = Math.floor((extraTime % 3600) / 60);
      const eseconds = extraTime % 60;
      
      document.getElementById('overtimeDisplay').innerText =
        `Fazla Mesai: ${ehours} saat ${eminutes} dakika ${eseconds} saniye`;

      checkDailyGoal(totalSec);
    }

    // Takibi Ba≈ülat
    function startTracking() {
      if (isRunning) return;

      const salary = parseFloat(salaryInput.value);
      if (isNaN(salary) {
        alert("L√ºtfen ge√ßerli bir maa≈ü bilgisi girin.");
        return;
      }

      if (!isRunning && baseSeconds === parseInt(localStorage.getItem('baseSeconds') || 0)) {
        const extraSec = ((+extraHoursInput.value || 0) * 3600) +
                         ((+extraMinutesInput.value || 0) * 60);
        baseSeconds += extraSec;
        localStorage.setItem('baseSeconds', baseSeconds);
      }

      startSound.currentTime = 0;
      startSound.play().catch(() => {});

      startTimestamp = Math.floor(Date.now() / 1000);
      isRunning = true;
      localStorage.setItem('startTimestamp', startTimestamp);
      localStorage.setItem('isRunning', 'true');

      updateDisplay();

      timer = setInterval(() => {
        const totalSec = getCurrentSeconds();
        earnings = calculateEarnings(totalSec);

        const todayKey = new Date().toISOString().split('T')[0];
        localStorage.setItem('daily_' + todayKey, earnings);
        localStorage.setItem('earnings', earnings);

        updateDisplay();
      }, 1000);
    }

    // Takibi Durdur
    function stopTracking() {
      if (!isRunning) return;
      
      stopSound.currentTime = 0;
      stopSound.play().catch(() => {});
      
      clearInterval(timer);

      const totalSec = getCurrentSeconds();
      baseSeconds = totalSec;
      localStorage.setItem('baseSeconds', baseSeconds);

      earnings = calculateEarnings(totalSec);
      localStorage.setItem('earnings', earnings);

      const todayKey = new Date().toISOString().split('T')[0];
      localStorage.setItem('daily_' + todayKey, earnings);

      isRunning = false;
      localStorage.setItem('isRunning', 'false');

      updateDisplay();
    }

    // G√ºnl√ºk Sƒ±fƒ±rlama
    function confirmDailyReset() {
      if (confirm("Bu g√ºn√ºn verileri silinecek. Emin misiniz?")) {
        resetDaily();
      }
    }

    function resetDaily() {
      const todayKey = new Date().toISOString().split('T')[0];
      localStorage.removeItem('daily_' + todayKey);
      localStorage.removeItem('goalCongrats_' + todayKey);
      
      baseSeconds = 0;
      earnings = 0;
      localStorage.setItem('baseSeconds', 0);
      localStorage.setItem('earnings', 0);
      
      if (isRunning) {
        startTimestamp = Math.floor(Date.now() / 1000);
        localStorage.setItem('startTimestamp', startTimestamp);
      }
      
      updateDisplay();
      drawChart();
    }

    // T√ºm Verileri Sƒ±fƒ±rlama
    function confirmAllReset() {
      if (confirm("Uygulamadaki t√ºm veriler silinecek. Emin misiniz?")) {
        resetAll();
      }
    }

    function resetAll() {
      clearInterval(timer);
      localStorage.clear();
      location.reload();
    }

    // Karanlƒ±k Mod
    function toggleDarkMode() {
      const newTheme = document.body.classList.contains('dark') ? 'light' : 'dark';
      document.body.classList.toggle('dark');
      localStorage.setItem('theme', newTheme);
      themeSelect.value = newTheme;
    }

    // G√∂r√ºn√ºm Deƒüi≈ütir
    function showView(view) {
      document.getElementById('mainView').classList.add('hidden');
      document.getElementById('profileView').classList.add('hidden');
      document.getElementById('settingsView').classList.add('hidden');
      document.getElementById(view + 'View').classList.remove('hidden');
      if (view === 'main') drawChart();
    }

    // Kariyer √ñnerileri
    function showSuggestions(text) {
      const val = text.toLowerCase();
      let msg = '';
      
      if (val.includes('yazƒ±lƒ±m')) msg = 'Yapay zeka, front-end veya mobil geli≈ütirici pozisyonlarƒ± ilginizi √ßekebilir.';
      else if (val.includes('tasarƒ±m')) msg = 'UI/UX, grafik tasarƒ±m alanlarƒ±nda freelance i≈üler d√º≈ü√ºnebilirsiniz.';
      else if (val.includes('kasiyer')) msg = 'Perakende, s√ºpermarket veya market zincirlerinde kasiyerlik pozisyonlarƒ±na bakabilirsiniz.';
      else if (val.includes('√∂ƒüretmen')) msg = 'E-√∂ƒürenme veya online ders platformlarƒ±nda √∂ƒüretmenlik ilanlarƒ±na g√∂z atabilirsiniz.';
      else if (val.includes('muhasebe')) msg = 'Finans, muhasebe veya denetim alanlarƒ±nda pozisyonlar arayabilirsiniz.';
      
      document.getElementById('careerSuggestion').innerText = msg;
    }

    // ƒ∞≈ü ƒ∞lanlarƒ±
    function showJobLinks(text) {
      const val = text.toLowerCase();
      const container = document.getElementById('jobLinks');
      container.innerHTML = '';
      
      if (val.includes('yazƒ±lƒ±m')) {
        container.innerHTML = `
          <a href="https://www.kariyer.net/ara?q=yazƒ±lƒ±m-geli≈ütirici" target="_blank">Yazƒ±lƒ±m Geli≈ütirici ƒ∞lanlarƒ±</a>
          <a href="https://www.kariyer.net/ara?q=front-end-geli≈ütirici" target="_blank">Front-end Geli≈ütirici ƒ∞lanlarƒ±</a>
        `;
      } else if (val.includes('tasarƒ±m')) {
        container.innerHTML = `
          <a href="https://www.kariyer.net/ara?q=ui-ux-tasarƒ±mcƒ±" target="_blank">UI/UX Tasarƒ±mcƒ± ƒ∞lanlarƒ±</a>
          <a href="https://www.kariyer.net/ara?q=grafik-tasarƒ±mcƒ±" target="_blank">Grafik Tasarƒ±mcƒ± ƒ∞lanlarƒ±</a>
        `;
      } else if (val.includes('kasiyer')) {
        container.innerHTML = `
          <a href="https://www.kariyer.net/ara?q=kasiyer" target="_blank">Kasiyer ƒ∞lanlarƒ±</a>
        `;
      } else if (val.includes('√∂ƒüretmen')) {
        container.innerHTML = `
          <a href="https://www.kariyer.net/ara?q=√∂ƒüretmen" target="_blank">√ñƒüretmen ƒ∞lanlarƒ±</a>
        `;
      } else if (val.includes('muhasebe')) {
        container.innerHTML = `
          <a href="https://www.kariyer.net/ara?q=muhasebe" target="_blank">Muhasebe ƒ∞lanlarƒ±</a>
        `;
      }
    }

    // Grafik √áiz
    function drawChart() {
      const ctx = document.getElementById('earningsChart').getContext('2d');
      const range = chartRangeSelect.value;
      const labels = [];
      const data = [];
      const today = new Date();

      if (range === 'daily') {
        for (let i = 6; i >= 0; i--) {
          const d = new Date(today);
          d.setDate(today.getDate() - i);
          const key = d.toISOString().split('T')[0];
          labels.push(key.slice(5));
          data.push(convertCurrency(+localStorage.getItem('daily_' + key) || 0));
        }
      } else if (range === 'weekly') {
        for (let w = 3; w >= 0; w--) {
          const start = new Date(today);
          start.setDate(today.getDate() - (w * 7));
          labels.push('Hafta ' + (4 - w));
          let sum = 0;
          for (let d = 0; d < 7; d++) {
            const dd = new Date(start);
            dd.setDate(start.getDate() + d);
            const key = dd.toISOString().split('T')[0];
            sum += +localStorage.getItem('daily_' + key) || 0;
          }
          data.push(convertCurrency(sum));
        }
      } else {
        for (let m = 11; m >= 0; m--) {
          const d = new Date(today.getFullYear(), today.getMonth() - m, 1);
          const monthKey = (d.getMonth() + 1).toString().padStart(2, '0') + '/' + d.getFullYear().toString().slice(2);
          labels.push(monthKey);
          let sum = 0;
          const year = d.getFullYear(), month = d.getMonth();
          const daysInMonth = new Date(year, month + 1, 0).getDate();
          for (let day = 1; day <= daysInMonth; day++) {
            const dd = new Date(year, month, day);
            const key = dd.toISOString().split('T')[0];
            sum += +localStorage.getItem('daily_' + key) || 0;
          }
          data.push(convertCurrency(sum));
        }
      }

      if (chartInstance) chartInstance.destroy();
      
      chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Kazan√ß (' + currency + ')',
            data: data,
            borderColor: 'rgba(26, 115, 232, 0.8)',
            backgroundColor: 'rgba(26, 115, 232, 0.3)',
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          scales: { 
            y: { 
              beginAtZero: true 
            } 
          }
        }
      });
    }

    // D√∂viz √áevir
    function convertCurrency(val) {
      return currency === 'TL' ? val : +(val / exchangeRate).toFixed(2);
    }

    // Sayfa Y√ºklendiƒüinde
    window.onload = () => {
      if (localStorage.getItem('isRunning') === 'true') {
        startTimestamp = parseInt(localStorage.getItem('startTimestamp')) || null;
        baseSeconds = parseInt(localStorage.getItem('baseSeconds')) || 0;
        isRunning = true;
        
        timer = setInterval(() => {
          const totalSec = getCurrentSeconds();
          earnings = calculateEarnings(totalSec);

          const todayKey = new Date().toISOString().split('T')[0];
          localStorage.setItem('daily_' + todayKey, earnings);
          localStorage.setItem('earnings', earnings);
          
          updateDisplay();
          if ((totalSec / 3600) >= goal) checkDailyGoal(totalSec);
        }, 1000);
      } else {
        baseSeconds = parseInt(localStorage.getItem('baseSeconds')) || 0;
        earnings = parseFloat(localStorage.getItem('earnings')) || 0;
        updateDisplay();
      }
      
      drawChart();
      showSuggestions(skillsInput.value);
      showJobLinks(skillsInput.value);
    };
  </script>
</body>
</html>
